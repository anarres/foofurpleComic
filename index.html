<!DOCTYPE html>

<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<title>Foofurple comics!</title>
<meta name="description" content="Make your own webcomic mash-up using amazing Creative Commons and Public Domain images.">
<link rel="icon" type="image/png" href="kittyIcon.png">
<link rel="stylesheet" type="text/css" href="kittyStyle.css">

<script type="text/javascript" src="kittyComicMetadata.js"></script>
<script type="text/javascript" src="utils/stringUtils.js"></script>
<script type="text/javascript" src="kittyComic.js"></script>
<script type="text/javascript" src="kittyComicDisplay.js"></script>
<script type="text/javascript" src="utils/jscolor/jscolor.js"></script>

<script>
var images88;
var theComic;

function updateMetadata() {
    var bg = getBgMetadata(theComic.bgArt);
    var left = getLeftMetadata(theComic.leftKittyUrl);
    var right = getRightMetadata(theComic.rightKittyUrl);
    document.getElementById('imagesMetadata').innerHTML = bg + left + right;
}

function chooseKitty() {
    var myObj = document.getElementById("chooseKitty");
    if ( myObj.style.visibility === "visible" ) {
        myObj.style.visibility = "hidden";
    }
    else {
        myObj.style.visibility = "visible";
        myObj.focus();
    }
}
function chooseBackgroundImage() {
    var myObj = document.getElementById("chooseBackgroundImage");
    if ( myObj.style.visibility === "visible" ) {
        myObj.style.visibility = "hidden";
    }
    else {
        myObj.style.visibility = "visible";
        myObj.focus();
    }
}
function loadBgImages() {
    var html = "<div id=\"removeBackgroundArt\"     onClick=\"selectBackgroundArt('')\" >       <a>Remove background art</a>     </div>";

    for( var i=0; i<images88[0].bg.length; i++ ) {
        html += "<img src='";
        html += images88[0].bg[i].url;
        html += "' id='";
        html += images88[0].bg[i].url;
        html += "' class='backgroundChooser' onClick=\"selectBackgroundArt('";
        html += images88[0].bg[i].url;
        html += "')\">";
    }
    document.getElementById("chooseBackgroundImage").innerHTML = html;
}

function selectBackgroundArt(url) {

    // Un-highlight previously selected image
    var imgArray = getElementsByClassName(document, 'backgroundChooser');
    for ( var i=0; i<imgArray.length; i++ ) {
        (imgArray[i]).style.backgroundImage="url('clear.png')";
    }
    // Hightlight newly selected image
    if (url !== "") {
        document.getElementById(url).style.backgroundImage="url('yellow.png')";
    }
    // Get all divs of class backgroundArt and give them this bg image
    var divs = getElementsByClassName(document, "backgroundArt");
    for (var j=0; j<divs.length; j++) {
        var myObj = divs[j];
        var myCSS = "url('" + url + "')";
        myObj.style.backgroundImage = myCSS;
    }
    theComic.bgArt = url;
    updateMetadata();
}

function selectKitty(num, imgUrl) {
    var myClassName = "imgChooser" + num;

    // Remove bg color from previously selected image
    var imgArray = getElementsByClassName(document, myClassName);
    for ( var i=0; i<imgArray.length; i++ ) {
        (imgArray[i]).style.backgroundImage="url('clear.png')";
    }
    // Set kitty1url (global var) and Change src of all kitty1's
    if ( num === 1 ) {
        var images = getElementsByClassName(document, "kitty1");
        for (var j=0; j<images.length; j++) {   
            (images[j]).setAttribute("src", imgUrl);
        }
        document.getElementById(imgUrl).style.backgroundImage="url('yellow.png')";
        theComic.leftKittyUrl = imgUrl;
    }
    // Do the same if kitty2
    else if ( num === 2) {
        var images2 = getElementsByClassName(document, "kitty2");
        for (var k=0; k<images2.length; k++ ) {
            (images2[k]).setAttribute("src", imgUrl);
        }  
        document.getElementById(imgUrl).style.backgroundImage="url('yellow.png')";
        theComic.rightKittyUrl = imgUrl;
    }
    updateMetadata();
}

function loadCharacters() {

    // Load the character images
    var htmlLeft = "";
    var htmlRight = "";
    for( var i=0; i<images88[1].characters.length; i++ ) {
        htmlLeft += "<img src='";
        htmlLeft += images88[1].characters[i].left.url;
        htmlLeft += "' id='";
        htmlLeft += images88[1].characters[i].left.url;
        htmlLeft += "' class='imgChooser1' onclick=\"selectKitty(1, '";
        htmlLeft += images88[1].characters[i].left.url;
        htmlLeft += "')\">";

        htmlRight += "<img src='";
        htmlRight += images88[1].characters[i].right.url;
        htmlRight += "' id='";
        htmlRight += images88[1].characters[i].right.url;
        htmlRight += "' class='imgChooser2' onclick=\"selectKitty(2, '";
        htmlRight += images88[1].characters[i].right.url;
        htmlRight += "')\">";
    }
    document.getElementById("kittyLeft").innerHTML = htmlLeft;
    document.getElementById("kittyRight").innerHTML = htmlRight;
}
function getStarted() {
    theComic = new KittyComic();
    theComic.createPanel();
    theComic.createPanel();   

    refreshDisplay(theComic);

    loadBgImages();
    loadCharacters();
    updateMetadata();
}
function newPanel() {
    theComic.createPanel();
    refreshDisplay(theComic);
}
function deletePanel() {
    theComic.delPanel();
    refreshDisplay(theComic);
}
function select(num) {
    theComic.setHighlight(num);
    refreshDisplay(theComic);
}
function textareaClick(pNum, leftOrRight) {
    var lr = parseInt(leftOrRight);
    var index = parseInt(pNum) - 1;

    // Model
    theComic.setBubbleFocus(index, lr);

    // Display - textarea
    var foo = lr + 1
    var tID = "textarea" + foo + "Panel" + pNum;
    var tObj = document.getElementById(tID);
    tObj.style.height = "160px";

    // Display - bubble image
    var imgID = "leftBubble" + pNum;
    if (leftOrRight == 1) {
        imgID = "rightBubble" + pNum;
    }
    var imgObj = document.getElementById(imgID);
    var panelObj = theComic.panelsArray[index];
    setBubbleImageMax(imgObj, lr, 0);
}

function textareaBlur(pNum, leftOrRight) {
    var lr = parseInt(leftOrRight);
    var index = parseInt(pNum) - 1;    
    var myId = "textarea1Panel" + pNum;
    if (lr == 1) {
        myId = "textarea2Panel" + pNum;
    }
    var text = document.getElementById(myId).value;

    // Write the text to the model
    theComic.setText(index, lr, text);

    // Display bubble image
    var imgID = "leftBubble" + pNum;
    if (lr == 1) {
        imgID = "rightBubble" + pNum;
    }
    var imgObj = document.getElementById(imgID);
    setBubbleImageUrl(imgObj, lr, text, 0);

    // Display - textarea
    var foo = lr + 1;
    var tID = "textarea" + foo + "Panel" + pNum;
    var tObj = document.getElementById(tID);
    setTextareaValue(tObj, text);
}

function changePanelBGColor() {
    var hexValue = "#" + document.getElementById('jscolor').value;    
    var divs = getElementsByClassName(document, 'backgroundArt');
    for (var i=0; i<divs.length; i++) {
        divs[i].style.backgroundColor = hexValue;
    }
    // Save the new value to the models
    theComic.setBgColor(document.getElementById("jscolor").value);
}

</script>

</head>

<body onload="getStarted()">

<div id="container">

<div id="chooseKitty" class="toggleDiv" tabindex="1" onBlur="document.getElementById('chooseKitty').style.visibility='hidden'">
    <div id="kittyLeft" style="width:45%;float:left;">
        <h3>Left</h3>
    </div> <!--#kittyLeft-->
    <div id="kittyRight" style="width:50%;float:left;border-left:3px dashed blue;">
        <h3>Right</h3>
    </div> <!--#kittyRight-->
</div> <!--#chooseKitty-->

<div id="chooseBackgroundImage" class="toggleDiv" tabindex="2" onBlur="document.getElementById('chooseBackgroundImage').style.visibility='hidden'">
    
</div> <!--#chooseBackgroundImage-->


    <div id="controls">

        <div class="buttonFoo" onClick="newPanel()">
            <a>
                <img src="images/plus_icon.png" style="width:25px;height:auto;" />
                New panel
            </a>
        </div>

        <div class="buttonFoo" onClick="deletePanel()">
            <a>
                <img src="images/minus_icon.png" style="width:25px;height:auto;" />
                Delete panel
            </a>
        </div>

        <div id="bubbleHint" class="infoDiv invisPosFixed">
            <div class="close" title="Close this window" 
                onclick="document.getElementById('bubbleHint').style.visibility='hidden'">
                <img src="close_icon.png" alt="close">
            </div> <!--.close-->
                <img src="alert.png" alt="alert" style="float:left;height:40px;margin:15px;">
                <p style="padding: 10px 40px;">First select a comic panel by clicking on it.</p>
        </div> <!--#bubbleHint-->

        <div class="buttonFoo" onclick="toggleBubble(1)">
            <a>
                <img src="images/left_bubble_icon.png" style="width:30px;height:auto" />
                Bubble 1
            </a>
        </div>

        <div class="buttonFoo" onclick="toggleBubble(2)">
            <a>
                <img src="images/right_bubble_icon.png" style="width:30px;height:auto" />
                Bubble 2
            </a>
        </div>

        <div class="buttonFoo" onclick="chooseKitty()">
            <a>
                <img src="images/kittyIcon.png" />
                <img src="images/kittyIcon2.png" />
                Characters
            </a>
        </div>

        <div class="buttonFoo" onclick="chooseBackgroundImage()">
            <a>
                <img src="images/background_icon.png" style="width:40px;height:auto;" />
                Background image
            </a>
        </div>

        <div class="buttonFoo" onclick="addNewImage()">
            <a>
                <img src="images/badly_drawn_figure_icon.png" style="width:30px;height:auto" />
                Add your own image
            </a>
        </div>

        <div class="buttonFoo" onclick="downloadImage()">
            <a>
                <img src="images/save.png" style="width:33px;height:auto" />
                Save
            </a>
        </div>

        <div class="buttonFoo colorWidget">
            <input type="text" class="color" value="3496CF"
                id="jscolor" onChange='changePanelBGColor()'>
        </div>

    </div><!--#controls-->
    <div style="clear:both;height:110px;">
    </div>

    <div id="header">
        <h1>Foofurple comics!</h1>
        <p style="text-align:center;">
            Make your own webcomic using amazing Creative Commons and Public Domain images. <a href="about.html">About</a>
        </p>    
        <div style="clear:both;"></div>
    </div> <!--#header-->

    <div id="comicPanels"></div>
    <div style="clear:both;height:30px;"></div>

    <div id="imagesMetadata" class="infoDiv">
        <h3>Images:</h3>
        <p id="metadata">.</p>
    </div> <!--#imagesMetadata-->

    <div style="height:50px;clear:both"></div>

</body>
</html>
